var Publisher_Theme_Admin=function(e){"use strict";return{init:function(){this.blocks_switch(),this.mailchimp(),this.custom_width_field(),this.setup_override_listing_settings(),this.white_label(),this.setup_listing_settings_override_event()},mailchimp:function(){e(document).on("change",".widget-mailchimp-code-field textarea",function(t,i){var n=e(this).val().match(/action="([^"]*?)"/i);void 0!=n&&void 0!==n[1]&&e(this).closest(".widget-mailchimp-code-field").siblings(".widget-mailchimp-url-field").find("input").val(n[1])}),e(document).on("change",'.wpb_el_type_textarea_raw_html textarea[name="mailchimp-code"]',function(){var t=e(this).val().match(/action="([^"]*?)"/i);void 0!=t&&void 0!==t[1]&&e(this).closest(".wpb_el_type_textarea_raw_html").siblings('div[data-vc-shortcode-param-name="mailchimp-url"]').find('textarea[name="mailchimp-url"]').val(t[1])})},blocks_switch:function(){e(document).on("click",".blocks-field .blocks-switch span, .blocks-field .title",function(){var t=e(this),i=t.closest(".blocks-field").find(".blocks-switch"),n=i.find("input"),a=i.closest(".bf-section-container").find('.blocks-field[data-related-to="'+t.closest(".blocks-field").data("id")+'"]');i.hasClass("checked")?(i.removeClass("checked").addClass("unchecked"),n.attr("value",0).change(),a.addClass("disabled")):(i.removeClass("unchecked").addClass("checked"),n.attr("value",1).change(),a.removeClass("disabled"))}).on("click",".blocks-field .blocks-checkbox-label",function(){var t=e(this).siblings(".blocks-checkbox");t.hasClass("checked")?(t.removeClass("checked").addClass("unchecked"),t.attr("value",0).change()):(t.removeClass("unchecked").addClass("checked"),t.attr("value",1).change())})},custom_width_field:function(){function t(e){return e.element.closest(".resizable-width-container")}function i(t){var i=0;return t.each(function(){i+=e(this).data("width-prc")}),i}function n(i){var n=[i.element,i.element.next(".resizable-width-column")],a=t(i),l=e(".resizable-width-column",a),s=l;return n.forEach(function(e){l=l.not(e)}),[l,s.not(l)]}function a(a,l){var o=t(l),c=n(l),r=c[1],h=e("input.total-width",o).val(),d=h-Math.ceil(i(c[0])/100*h);r.length||(r=e(".resizable-width-column",o),d=h),r.filter(":not(:last)").each(function(t){var i=e(this),n=i.data("width-prc"),a=Math.ceil(n/100*h);i.data("width-px",a).find(".resizable-width-labels-px").text(a+"px"),a<=s.columnMinWidth&&i.resizable("option","minWidth",i.outerWidth()),d-=a}),r.filter(":last").data("width-px",d).find(".resizable-width-labels-px").text(d+"px")}function l(e){return e.data("columns")||2}var s={columnMinWidth:150,wrapper2ColumnMinWidth:600,wrapper3ColumnMinWidth:1e3,wrapperMaxWidth:1640,transformPxRatio:10,borderSpacing:4};e(".resizable-width-column").each(function(){var t=e(this),i=t.data("width-prc");i&&t.outerWidth(i+"%")}),e(".resizable-width-columns").each(function(){e(".resizable-width-column:not(:last)",this).resizable({handles:"e",minHeight:250,maxHeight:250,stop:function(t,i){var n=0,a=[];e(".resizable-width-column",i.element.parent()).each(function(){var t=e(this),i=t.outerWidth();n+=i,a.push([t,i])}).promise().done(function(){n/=100;for(var e=0;e<a.length;e++){a[e][0].width(a[e][1]/n+"%")}})},resize:function(l,s){!function(a,l){var s=t(l),o=n(l),c=e(".resizable-width-section",s).outerWidth(),r=o[1],h=100-i(o[0]);r.filter(":not(:last)").each(function(){var t=e(this),i=Math.ceil(100*t.outerWidth()/c);t.data("width-prc",i).find(".resizable-width-labels-percentage").text(i+"%"),e("input.col-"+t.data("index")+"-width",s).val(i),h-=i}),h=Math.abs(h);var d=r.filter(":last");d.data("width-prc",h).find(".resizable-width-labels-percentage").text(h+"%"),e("input.col-"+d.data("index")+"-width",s).val(h)}(0,s),a(0,s)},start:function(i,n){!function(i){var n=t(i),a=e(".resizable-width-columns-wrapper",n),o=e("input.total-width",n).val(),c=Math.max(2,l(a)-1)*s.borderSpacing,r=a.width(),h=Math.floor(s.columnMinWidth*r/o);i.originalElement.resizable("option","minWidth",h);var d=i.originalElement.next(".resizable-width-column").width()+i.originalElement.width()+c-h;i.originalElement.resizable("option","maxWidth",d)}(n),function(i){var n=[i.element,i.element.next(".resizable-width-column")],a=t(i),l=e(".resizable-width-column",a);n.forEach(function(e){l=l.not(e)}),l.each(function(){var t=e(this),i=t.outerWidth();t.outerWidth(i).css({"min-width":i,"max-width":i})}),n.forEach(function(e){e.attr("style","")})}(n)}})}),e(".resizable-width-container").each(function(){function i(e){return(e-h)/(s.transformPxRatio/2)+r}var n=e(this),o=n.find(".resizable-width-columns-wrapper"),c=l(o),r=(2==c?44:70)*c,h=2==c?s.wrapper2ColumnMinWidth:s.wrapper3ColumnMinWidth,d=i(s.wrapperMaxWidth),m=i(o.data("total"));e(".resizable-width-total-wrapper",n).width(m),o.width(m),o.resizable({minHeight:280,maxHeight:280,handles:"e,w",minWidth:r,maxWidth:d,resize:function(i,n){if(!(n.size.width%2)){var l=t(n),o=h+(n.size.width-r)/2*s.transformPxRatio;o=function(e){return e%2&&e++,e}(o),e(".resizable-width-total-wrapper",l).outerWidth(n.size.width).css("left",n.position.left),e(".resizable-width-total-number",l).text(Math.ceil(o)+"px"),e("input.total-width",l).val(o),a(0,n)}},start:function(i,n){n.element.find(".resizable-width-column").css({"min-width":"","max-width":""});var a=t(n);e(".resizable-width-column",a).each(function(){var t=e(this),i=t.find(".resizable-width-labels-percentage").text();t.outerWidth(i)})}}).data("resize-options",{maxWidth:d})})},setup_override_listing_settings:function(){var t,i=[".wpb_edit_form_elements",".kc-pop-tab"];t=[],i.forEach(function(e){t.push(e+" .advanced-block-settings :input")}),e(document).on("change",t.join(","),function(){var t="",n=e(this),a=n.closest(i.join(",")),l=e("input[name='override-listing-settings']",a).val(),s=e("input[name='listing-settings']",a);"0"!==l&&(t=n.closest(".advanced-block-settings").bf_serialize()),0===s.length?e("<input/>",{name:"listing-settings",class:"wpb_vc_param_value kc-param",value:t,type:"hidden"}).appendTo(a):s.val(t)}),t=[],i.forEach(function(e){t.push(e+' input[name="override-listing-settings"]')}),e(document).on("change",t.join(","),function(){if("0"===this.value){var t=e(this).closest(i.join(","));e("input[name='listing-settings']",t).remove()}})},setup_listing_settings_override_event:function(){e(document).ajaxSuccess(function(){var t=e(".wpb_edit_form_elements");e(".blocks-field :input:first",t).trigger("change")}),e(document).on("bf-kc-tab-loaded",function(t,i){e(".blocks-field :input:first",i).trigger("change")})},white_label:function(){function t(e){if(a.length>0){(t=a.attr("href").split(/[\s/]+/))[1]=""==e?"publisher":e,a.attr("href",t.join("/"))}if(c.length>0){var t=c.attr("href").split(/[\s/]+/);t[t.length-1]=""==e?"publisher":e,c.attr("href",t.join("/"))}}if(!(e("#bf-panel.panel-publisher-white-label .bf-controls input[name=publisher]").length<=0)){var i=e("li#toplevel_page_bs-product-pages-welcome > a .wp-menu-name"),n=i.find(".plugin-count"),a=e('li#toplevel_page_bs-product-pages-welcome li a[href="admin.php?page=better-studio/publisher"]'),l=e("li#wp-admin-bar-bs-product-pages-welcome-parent > a"),s=l.find(".plugin-count"),o=l.find(".bf-admin-bar-icon-bs-product-pages-welcome"),c=e('li#wp-admin-bar-bs-product-pages-welcome-parent li[id="wp-admin-bar-better-studio/publisher"] a');n=n.length>0?n[0].outerHTML:"",s=s.length>0?s[0].outerHTML:"",o=o.length>0?o[0].outerHTML:"";var r={};r["bs-icons"]="bs-icons",r.fontawesome="FontAwesome",i.length>0&&e("#bf-panel.panel-publisher-white-label .bf-controls input[name=publisher]").on("keyup",function(){""===e(this).val()?(t(""),""!==s?i.html('Publisher <span class="bs-admin-menu-badge">'+n+"</span>"):i.html("Publisher")):(t("theme"),""!==s?i.html(e(this).val()+' <span class="bs-admin-menu-badge">'+n+"</span>"):i.html(e(this).val()))}),l.length>0&&e("#bf-panel.panel-publisher-white-label .bf-controls input[name=publisher]").on("keyup",function(){""===e(this).val()?""!==s?l.html(o+'Publisher <span class="bs-admin-menu-badge">'+s+"</span>"):l.html(o+"Publisher"):""!==s?l.html(o+e(this).val()+' <span class="bs-admin-menu-badge">'+s+"</span>"):l.html(o+e(this).val())}),e("#bf-panel.panel-publisher-white-label .bf-section[data-id=theme_icon] .bf-controls input.icon-input").on("change",function(){""==e(this).siblings("input.icon-input-font-code").val()?e("<style>li#wp-admin-bar-bs-product-pages-welcome-parent .bf-admin-bar-icon-bs-product-pages-welcome:before,#adminmenu li#toplevel_page_bs-product-pages-welcome .wp-menu-image.wp-menu-image.wp-menu-image.wp-menu-image:before{ content: '\\b024' !important; font-family: '"+r["bs-icons"]+"'; }</style>").appendTo("head"):e("<style>li#wp-admin-bar-bs-product-pages-welcome-parent .bf-admin-bar-icon-bs-product-pages-welcome:before,#adminmenu li#toplevel_page_bs-product-pages-welcome .wp-menu-image.wp-menu-image.wp-menu-image.wp-menu-image:before{ content: '"+e(this).siblings("input.icon-input-font-code").val()+"' !important; font-family: '"+r[e(this).siblings("input.icon-input-type").val()]+"'; }</style>").appendTo("head")}),e("#bf-panel.panel-publisher-white-label .bf-controls input[name=white_label]").on("change",function(){var i=0==e("#bf-panel.panel-publisher-white-label .bf-controls input[name=white_label]").val()?"":"theme";"theme"==i&&""==e("#bf-panel.panel-publisher-white-label .bf-controls input[name=publisher]").val()&&(i=""),t(i)})}}}}(jQuery);jQuery(document).ready(function(){Publisher_Theme_Admin.init()});