/***
 *  BetterFramework is BetterStudio framework for themes and plugins.
 *
 *  ______      _   _             ______                                           _
 *  | ___ \    | | | |            |  ___|                                         | |
 *  | |_/ / ___| |_| |_ ___ _ __  | |_ _ __ __ _ _ __ ___   _____      _____  _ __| | __
 *  | ___ \/ _ \ __| __/ _ \ '__| |  _| '__/ _` | '_ ` _ \ / _ \ \ /\ / / _ \| '__| |/ /
 *  | |_/ /  __/ |_| ||  __/ |    | | | | | (_| | | | | | |  __/\ V  V / (_) | |  |   <
 *  \____/ \___|\__|\__\___|_|    \_| |_|  \__,_|_| |_| |_|\___| \_/\_/ \___/|_|  |_|\_\
 *
 *  Copyright Â© 2017 Better Studio
 *
 *
 *  Our portfolio is here: https://betterstudio.com/
 *
 *  \--> BetterStudio, 2017 <--/
 */
!function(t){"use strict";var n=0,s=[],e=function(n){function s(){return!0}this.options=t.extend(!0,{template:"default",skin:"skin-1",initialZIndex:0,show:!0,content:{},close_button:!0,button_position:"right",animations:{delay:600,open:"bs-animate bs-fadeInDown",close:"bs-animate bs-fadeOutUp"},buttons:{},events:{before_click:s,clicked:s,handle_keyup:function(t,n,s){return s}},styles:{modal:"",container:""},modalId:"modal-"+Math.floor(999*Math.random()),modalClass:"",destroyHtml:!0,is_vertical_center:!0},n),this.$modal=!1,this.$overlay=!1,this.timerTimeouts=[],this.$document=!1,this.modalID=!1,this.visible=!1,this.init()};e.prototype={templates:{"default":'\n<div class="bs-modal-default"  {{#inline_style}} style="{{inline_style}}" {{/inline_style}}>\n    {{#close_button}}\n    <a href="#" class="bs-close-modal">\n        <i class="fa fa-times" aria-hidden="true"></i>\n    </a>\n    {{/close_button}}\n    <div class="bs-modal-header-wrapper bs-modal-clearfix">\n        <h2 class="bs-modal-header">\n            {{#icon}}\n            <i class="fa {{icon}}"></i>\n            {{/icon}}\n\n            {{header}}\n        </h2>\n    </div>\n\n    <div class="bs-modal-body">\n        {{{bs_body}}}\n    </div>\n\n    {{#bs_buttons}}\n    <div class="bs-modal-bottom bs-modal-buttons-{{btn_position}} bs-modal-clearfix">\n        {{{bs_buttons}}}\n    </div>\n    {{/bs_buttons}}\n</div>',single_image:'\n<div class="bs-modal-default" {{#inline_style}} style="{{inline_style}}" {{/inline_style}}>\n    {{#close_button}}\n    <a href="#" class="bs-close-modal">\n        <i class="fa fa-times" aria-hidden="true"></i>\n    </a>\n    {{/close_button}}\n    <div class="bs-modal-header-wrapper bs-modal-clearfix">\n        <h2 class="bs-modal-header">\n            {{#icon}}\n            <i class="fa {{icon}}"></i>\n            {{/icon}}\n\n            {{header}}\n        </h2>\n    </div>\n\n    <div class="bs-modal-body bf-clearfix">\n        \n        <div class="bs-modal-image bf-clearfix" {{#image_align}} style="float:{{image_align}}"{{/image_align}}>\n\n            <img src="{{image_src}}" {{#image_style}} style="{{image_style}}"{{/image_style}}/>\n            \n            {{#image_caption}}\n            <div class="bs-modal-image-caption">\n                {{image_caption}}\n            </div>\n            {{/image_caption}}\n        </div>\n        {{{bs_body}}}\n    </div>\n\n    {{#bs_buttons}}\n    <div class="bs-modal-bottom bs-modal-buttons-left bs-modal-clearfix">\n        {{{bs_buttons}}}\n        \n        {{#checkbox}}\n        <div class="bs-modal-checkbox">\n            <input type="checkbox" name="include_content" class="toggle-content" value="1" checked="checked"> <label class="checkbox-label">{{checkbox_label}}</label>\n        </div>\n        {{/checkbox}}\n    </div>\n    {{/bs_buttons}}\n</div>'},skins:{"skin-1":'<div class="bs-modal-description">\n   {{#title}} <h3 class="bs-modal-title">{{title}}</h3>\n   {{/title}} \n    {{{body}}}\n</div>',loading:' <div class="bs-modal-loading bs-modal-loading-1">\n    <img src="data:image/false;base64,R0lGODlhIAAIAPEAALy8vHh4eP///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hhPcHRpbWl6ZWQgd2l0aCBlemdpZi5jb20AIfkEBQsAAQAsAAAAACAACAAAAiGEb6GBuNyiWxK8Wq/UuHFPdaCSheLxTeSJmiPEWq4KNwUAIfkEBQsAAAAsAAAAAAgACAAAAgaMj6nL7V0AIfkEBQsAAgAsAAAAABQACAAAAhuEb6IS7Y3QYs/FM6u9IOvAdcsHcp4WnlU6fgUAIfkEBQsAAgAsDAAAABQACAAAAhuEb6IS7Y3QYs/FM6u9IOvAdcsHcp4WnlU6fgUAOw==" />\n\n     <div class="bs-modal-loading-heading">\n         <h4>{{loading_heading}}</h4>\n     </div>\n </div>\n',"loading-2":' <div class="bs-modal-loading">\n     <div class="la-line-scale-pulse-out-rapid la-2x">\n         <div></div>\n         <div></div>\n         <div></div>\n         <div></div>\n         <div></div>\n     </div>\n     \n     <div class="bs-modal-loading-heading">\n         <h4>{{loading_heading}}</h4>\n     </div>\n</div>\n',success:' <div class="bs-modal-success">\n     \n     <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>\n     \n     <div class="bs-modal-bs-modal-success-heading">\n         <h4>{{success_heading}}</h4>\n     </div>\n</div>\n'},button_struct:'<a {{#href}}href="{{href}}"{{/href}} {{#btn_classes}}class="{{btn_classes}}"{{/btn_classes}} id="{{id}}">{{{label}}}</a>',debug:function(t){console.error(t)},get_html:function(n,s,e){if("undefined"==typeof this.templates[n])return this.debug("invalid template name"),!1;if("undefined"==typeof this.skins[s])return this.debug("invalid skin"),!1;Mustache.parse(this.templates[n]);Mustache.parse(this.skins[s]);var i=Mustache.render(this.skins[s],e),o={bs_body:i,bs_buttons:this.generate_buttons(),close_button:this.options.close_button,inline_style:this.options.styles.modal,btn_position:this.options.button_position};return this.handle_event("prepare_html",this,n,s,e),Mustache.render(this.templates[n],t.extend(e,o))},before_append_html:function(t){this.handle_event("before_append_html",this,t)},after_append_html:function(t){this.options.is_vertical_center&&this.make_vertical_center(),this.$modal.focus(),this.handle_event("after_append_html",this,t)},after_close_modal:function(){t(window).off("resize.bs-modal"),s.pop()},has_button:function(){return"object"==typeof this.options.buttons},append_html:function(){this.before_append_html("modal");var t=this.get_html(this.options.template,this.options.skin,this.options.content);return"string"!=typeof t?t:(this.$modal.html(t),this.after_append_html("modal"),!0)},generate_buttons:function(){if(!this.has_button())return"";Mustache.parse(this.button_struct);var t="";for(var n in this.options.buttons)t+="\n",t+=Mustache.render(this.button_struct,this.get_button_replacement_object(n));return t},get_button_replacement_object:function(n){if("object"!=typeof this.options.buttons[n])return this.debug("invalid button id"),{};var s=t.extend({focus:!1},this.options.buttons[n]);return delete s.clicked,s.id=n,"string"!=typeof s.btn_classes&&(s.btn_classes=""),-1!==t.inArray(s.type,["primary","secondary"])&&(s.btn_classes+=" bs-modal-btn-"+s.type),s.focus&&(s.btn_classes+=" bs-modal-btn-focus"),s},close_modal:function(t){this.visible=!1;var n=this,t=t||"callback";n.handle_event("modal_close",this,t);for(var s=0;s<this.timerTimeouts.length;s++)clearTimeout(this.timerTimeouts[s]);n.$modal.removeClass(this.options.animations.open).addClass(this.options.animations.close).delay(this.options.animations.delay).queue(function(t){n.$modal.hide().removeClass(n.options.animations.close),n.options.destroyHtml?n.$modal.remove():n.$modal.clearQueue(),t()}),n.$overlay.fadeOut(this.options.animations.delay,function(){n.options.destroyHtml&&n.find().remove(),n.$document.removeClass("modal-open").removeClass("modal-open-vc"),n.keyup_unbind(),n.handle_event("modal_closed",this,t)}),n.after_close_modal()},keyup_unbind:function(){this.options.destroyHtml&&this.$document.off("keyup.bs-modal-"+this.getModalID())},handle_event:function(t,n){var s=Array.prototype.slice.call(arguments,2);return"function"==typeof this.options.events[t]?this.options.events[t].apply(this,[n,this.options].concat(s)):void 0},handle_timer:function(t){var n=this;this.timerTimeouts.push(setTimeout(function(){t.callback.call(n,n.option)},t.delay))},change_skin:function(s,e){e="boolean"==typeof e?e:!0;var i=t.extend(e,{template:this.options.template,skin:this.options.skin,content:this.options.content,animations:{open:!1,body:!1,delay:20},buttons:{},styles:{}},s);if(this.options.buttons=i.buttons,i.styles.container){var o={inline_style:i.styles.container},a=Mustache.render('<div class="bs-modal" {{#inline_style}} style="{{inline_style}}" {{/inline_style}}></div>\n',o);this.$modal[0].outerHTML=a,this.$modal=this.find(".bs-modal").css("z-index",n+1).show(),this.afterWrapperHtmlGenerated()}var l=this.get_html(i.template,i.skin,i.content);return"string"!=typeof l?l:(this.$modal.html(l).removeClass(this.options.animations.open).delay(20).queue(function(n){i.animations.open&&t(this).addClass(i.animations.open),n()}).removeClass(function(t,n){return(n.match(/(^|\s)skin-\S+/g)||[]).join(" ")}).addClass("skin-"+i.skin).find(".bs-modal-body").addClass(i.animations.body),"object"==typeof i.timer&&this.handle_timer(i.timer),this.after_append_html("change_skin"),void this.handle_event("modal_loaded",this))},make_vertical_center:function(){var n=this;t(window).on("resize.bs-modal",function(){if(!n.isModalLast())return!1;var t=n.$modal.innerHeight(),s=window.innerHeight;if(s>t)var e=Math.ceil((s-t)/2);else var e=35;n.$modal.css("top",e)}).trigger("resize.bs-modal")},getModalID:function(){return this.modalID},setModalID:function(t){this.modalID=t},setActiveModalId:function(t){s.push(t)},getActiveModalId:function(){return s.length?s[s.length-1]:0},isModalLast:function(){return this.getActiveModalId()===this.getModalID()},find:function(n){var s=this.$document.find("#"+this.getModalID());return n?t(n,s):s},_fixModalZindex:function(){},show:function(){var t=this;t.$document.find(".vc_ui-panel.vc_active .vc_ui-panel-window-inner").length&&t.$document.addClass("modal-alongside-vc-panel"),this.$overlay.fadeIn(this.options.animations.open,function(){t.$document.addClass("modal-open")}),this.$modal.addClass(t.options.animations.open).addClass("skin-"+t.options.skin).show().delay(t.options.animations.delay).queue(function(n){"object"==typeof t.options.timer&&t.handle_timer(t.options.timer),n()}),this.setActiveModalId(this.getModalID()),this.visible=!0,this.handle_event("modal_show",this)},init:function(){this.$document=t(document.body);var s=this;this.setModalID(this.options.modalId),this.setActiveModalId(this.getModalID());var e=0===this.find().length;if(e){var i={inline_style:this.options.styles.container,modal_id:this.getModalID(),modal_class:this.options.modalClass};this.$document.append(Mustache.render('<div id="{{modal_id}}"{{#modal_class}} class="{{modal_class}}"{{/modal_class}}>\n    <div class="bs-modal-overlay"></div>\n        <div class="bs-modal" {{#inline_style}} style="{{inline_style}}" {{/inline_style}}>\n    </div>\n</div>',i))}this.$modal=this.find(".bs-modal"),this.$overlay=this.find(".bs-modal-overlay"),n?(n=Math.max(n,this.options.initialZIndex),n++,this.$overlay.css("z-index",n),this.$modal.css("z-index",n+1)):this.options.initialZIndex?(this.$overlay.css("z-index",this.options.initialZIndex),this.$modal.css("z-index",this.options.initialZIndex+1),n=this.options.initialZIndex):n=parseInt(this.$modal.css("z-index")),e&&s.afterWrapperHtmlGenerated(),this.options.close_button&&this.$document.on("keyup.bs-modal-"+this.getModalID(),function(n){if(!s.handle_event("handle_keyup",n,s.isModalLast()))return!1;if("TEXTAREA"===n.target.tagName)return!1;if(s.options.close_button&&27===n.which)s.close_modal("esc");else if(13===n.which){if(s.has_button()){var e=s.$modal.find(".bs-modal-bottom"),i=t(".bs-modal-btn-focus",e);i.length||(i=t(".bs-modal-btn-primary",e)),i.trigger("click")}s.keyup_unbind()}}),this.options.show&&s.show(),e&&s.append_html(),this.handle_event("modal_loaded",this)},afterWrapperHtmlGenerated:function(){var n=this;this.$modal.on("click","a",function(s){if(n.handle_event("before_click",this)){var e=t(this),i=e.attr("id");if(e.hasClass("bs-close-modal"))s.preventDefault(),n.close_modal("btn");else if(i&&"object"==typeof n.options.buttons[i]){var o=n.options.buttons[i];switch(o.action){case"close":n.close_modal("link")}"function"==typeof o.clicked&&o.clicked.call(n)}n.handle_event("clicked",this)}})}},t.bs_modal=function(t){return new e(t)},t.bs_modal_template=function(t,n){return n?void(e.prototype.templates[t]=n):e.prototype.templates[t]}}(jQuery);